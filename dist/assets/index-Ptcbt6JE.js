(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}})();var o;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.FFPROBE="FFPROBE",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(o||(o={}));const N=(()=>{let t=0;return()=>t++})(),_=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),B=new Error("called FFmpeg.terminate()");class U{#t=null;#s={};#r={};#n=[];#o=[];loaded=!1;#a=()=>{this.#t&&(this.#t.onmessage=({data:{id:e,type:r,data:n}})=>{switch(r){case o.LOAD:this.loaded=!0,this.#s[e](n);break;case o.MOUNT:case o.UNMOUNT:case o.EXEC:case o.FFPROBE:case o.WRITE_FILE:case o.READ_FILE:case o.DELETE_FILE:case o.RENAME:case o.CREATE_DIR:case o.LIST_DIR:case o.DELETE_DIR:this.#s[e](n);break;case o.LOG:this.#n.forEach(s=>s(n));break;case o.PROGRESS:this.#o.forEach(s=>s(n));break;case o.ERROR:this.#r[e](n);break}delete this.#s[e],delete this.#r[e]})};#e=({type:e,data:r},n=[],s)=>this.#t?new Promise((a,d)=>{const i=N();this.#t&&this.#t.postMessage({id:i,type:e,data:r},n),this.#s[i]=a,this.#r[i]=d,s?.addEventListener("abort",()=>{d(new DOMException(`Message # ${i} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(_);on(e,r){e==="log"?this.#n.push(r):e==="progress"&&this.#o.push(r)}off(e,r){e==="log"?this.#n=this.#n.filter(n=>n!==r):e==="progress"&&(this.#o=this.#o.filter(n=>n!==r))}load=({classWorkerURL:e,...r}={},{signal:n}={})=>(this.#t||(this.#t=e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("/riys-converter/assets/worker-BAOIWoxA.js",import.meta.url),{type:"module"}),this.#a()),this.#e({type:o.LOAD,data:r},void 0,n));exec=(e,r=-1,{signal:n}={})=>this.#e({type:o.EXEC,data:{args:e,timeout:r}},void 0,n);ffprobe=(e,r=-1,{signal:n}={})=>this.#e({type:o.FFPROBE,data:{args:e,timeout:r}},void 0,n);terminate=()=>{const e=Object.keys(this.#r);for(const r of e)this.#r[r](B),delete this.#r[r],delete this.#s[r];this.#t&&(this.#t.terminate(),this.#t=null,this.loaded=!1)};writeFile=(e,r,{signal:n}={})=>{const s=[];return r instanceof Uint8Array&&s.push(r.buffer),this.#e({type:o.WRITE_FILE,data:{path:e,data:r}},s,n)};mount=(e,r,n)=>{const s=[];return this.#e({type:o.MOUNT,data:{fsType:e,options:r,mountPoint:n}},s)};unmount=e=>{const r=[];return this.#e({type:o.UNMOUNT,data:{mountPoint:e}},r)};readFile=(e,r="binary",{signal:n}={})=>this.#e({type:o.READ_FILE,data:{path:e,encoding:r}},void 0,n);deleteFile=(e,{signal:r}={})=>this.#e({type:o.DELETE_FILE,data:{path:e}},void 0,r);rename=(e,r,{signal:n}={})=>this.#e({type:o.RENAME,data:{oldPath:e,newPath:r}},void 0,n);createDir=(e,{signal:r}={})=>this.#e({type:o.CREATE_DIR,data:{path:e}},void 0,r);listDir=(e,{signal:r}={})=>this.#e({type:o.LIST_DIR,data:{path:e}},void 0,r);deleteDir=(e,{signal:r}={})=>this.#e({type:o.DELETE_DIR,data:{path:e}},void 0,r)}var I;(function(t){t.MEMFS="MEMFS",t.NODEFS="NODEFS",t.NODERAWFS="NODERAWFS",t.IDBFS="IDBFS",t.WORKERFS="WORKERFS",t.PROXYFS="PROXYFS"})(I||(I={}));const S=new Error("failed to get response body reader"),F=new Error("failed to complete download"),P="Content-Length",C=t=>new Promise((e,r)=>{const n=new FileReader;n.onload=()=>{const{result:s}=n;s instanceof ArrayBuffer?e(new Uint8Array(s)):e(new Uint8Array)},n.onerror=s=>{r(Error(`File could not be read! Code=${s?.target?.error?.code||-1}`))},n.readAsArrayBuffer(t)}),T=async t=>{let e;if(typeof t=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t)?e=atob(t.split(",")[1]).split("").map(r=>r.charCodeAt(0)):e=await(await fetch(t)).arrayBuffer();else if(t instanceof URL)e=await(await fetch(t)).arrayBuffer();else if(t instanceof File||t instanceof Blob)e=await C(t);else return new Uint8Array;return new Uint8Array(e)},k=async(t,e)=>{const r=await fetch(t);let n;try{const s=parseInt(r.headers.get(P)||"-1"),a=r.body?.getReader();if(!a)throw S;const d=[];let i=0;for(;;){const{done:f,value:m}=await a.read(),w=m?m.length:0;if(f){if(s!=-1&&s!==i)throw F;e&&e({url:t,total:s,received:i,delta:w,done:f});break}d.push(m),i+=w,e&&e({url:t,total:s,received:i,delta:w,done:f})}const O=new Uint8Array(i);let D=0;for(const f of d)O.set(f,D),D+=f.length;n=O.buffer}catch(s){console.log("failed to send download progress event: ",s),n=await r.arrayBuffer()}return n},L=async(t,e,r=!1,n)=>{const s=r?await k(t,n):await(await fetch(t)).arrayBuffer(),a=new Blob([s],{type:e});return URL.createObjectURL(a)},l=document.getElementById("dropArea"),A=document.getElementById("fileInput"),W=document.getElementById("fileInfo"),$=document.getElementById("fileName"),h=document.getElementById("convertBtn"),p=document.getElementById("outputFormat"),g=document.getElementById("status"),y=document.getElementById("progressBar"),R=document.getElementById("progressFill");let c=null,E=null;async function j(){if(c)return;u("Loading FFmpeg...","info"),c=new U,c.on("log",({message:s})=>{console.log(s)}),c.on("progress",({progress:s})=>{const a=Math.round(s*100);R.style.width=`${a}%`});const t="/riys-converter/ffmpeg",e=await L(`${t}/ffmpeg-core.js`,"text/javascript"),r=await L(`${t}/ffmpeg-core.wasm`,"application/wasm"),n=await L(`${t}/ffmpeg-core.worker.js`,"text/javascript");await c.load({coreURL:e,wasmURL:r,workerURL:n}),u("FFmpeg loaded and ready","success"),setTimeout(()=>v(),2e3)}l.addEventListener("click",()=>A.click());l.addEventListener("dragover",t=>{t.preventDefault(),l.classList.add("dragover")});l.addEventListener("dragleave",()=>{l.classList.remove("dragover")});l.addEventListener("drop",t=>{t.preventDefault(),l.classList.remove("dragover");const e=t.dataTransfer.files;e.length>0&&b(e[0])});A.addEventListener("change",t=>{t.target.files.length>0&&b(t.target.files[0])});function b(t){E=t,$.textContent=t.name,W.classList.add("show"),h.disabled=!1,v()}h.addEventListener("click",async()=>{if(E)try{h.disabled=!0,y.classList.add("show"),R.style.width="0%",await j();const t=E.name,e=`converted.${p.value}`;u("Processing file...","info"),await c.writeFile(t,await T(E)),await c.exec(["-i",t,e]);const r=await c.readFile(e),n=new Blob([r.buffer],{type:`audio/${p.value}`}),s=URL.createObjectURL(n),a=document.createElement("a");a.href=s,a.download=`${E.name.split(".")[0]}.${p.value}`,a.click(),URL.revokeObjectURL(s),await c.deleteFile(t),await c.deleteFile(e),u("Conversion complete! File downloaded.","success"),R.style.width="100%"}catch(t){console.error("Conversion error:",t),u(`Error: ${t.message}`,"error")}finally{h.disabled=!1,setTimeout(()=>{y.classList.remove("show"),R.style.width="0%"},2e3)}});function u(t,e){g.textContent=t,g.className=`status show ${e}`}function v(){g.classList.remove("show")}
